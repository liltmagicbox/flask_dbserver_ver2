
오후 4:10 2020-10-28
좋아,갖춰졌다.
정적데이터,크롤링하는 datas는 그대로 유지하는걸로. 여기엔 뭘 쓰지 않고,
기존에 저장된 녀석을 불러 와서 다시 추가하고 저장하는, 동일한 작동방식을 보이도록 하는 것이야.

입력받는 유동적인데이터는 전체를 묶어서 따로 관리해야겠어.응.
이것은, 놀랍게도, 안 한건 없는것으로 해버려도 되는거니까 썩 편하지 싶은것이야.
로그의 작업이력과 연계해서 동작하도록.
headdict는, datas의 축소판으로 두되, 원래 목적이었던 내부 sort는 정적으로 담당하기만하는것이고
유동적으로 변하는것이 되었기때문에 다르게 가는게 필요한것이야.
아.그런데 뮤즈태그는 이쪽에 넣을까 싶기도 하네.흠...
그럼 datas의 일관적 쓰기 정책이 위배되잖아.

편히 말하자면야 물론 태그도 입력과정을 거치는거니 static하게 남아있을이유가없긴하지..

태그={
코토리:[]
코토우미:[]
}
유저태그={
모후모후=[]
}
식인것이야.
no반복되는게 정 싫으면 base64인코딩하면 데이터량도 줄겠고! 근데 가독성때문에 굳이그러진말자;

이건 주로 탐색이 대부분의 목적이고 입력의 편의성등을고려하자면 이방식이 압도적으로 좋은것이야.

sort를 위해선,그러나,

조회수={
14=[]
11=[]
1=[]
}
식으로 들어가는게 썩 이상하긴 하다; 되게편하긴한데말야. 이건 그리고 글 에 대해서 반영되는거니 상황이다름.
기존의 날짜순은 어떻게 했지? 항목을 가져와서, 키-리스트를 뒤집은뒤에, 역정렬하고 매칭했군. 대단하다;
1.nolist만.[]
2.nolist와,[] 실제숫자들.[111,2234,555]를 보내면 되겠지.응. 이러면 미리보기표시가능.

datas에 통합접근하려는 가장 큰 목적은 알다시피 오프라인이었는데, 순간왜곡이 이렇게영향준거라생각해.




1.datas는 크롤링한것의 추가만 하는, 일관된 작용을 하게 한다.
유저태그 랍시고 저장되긴하는데 txt태그로 명칭변경?
여기에, 가능하면 그.. 태그정보도 저장하고싶었으나, 관두기로 한다. 데이터 성격의 격리를 위해.
조회수도해서 다 통합하려했는데 일단 안 하기로.유동데이터니까..
데이터의 완전성을 유지하고싶어.

2. 유동데이터로, 태그, 조회수등, 을 둔다.
태그는, 번호에대해 하는게,안필요하진않다..

taglist = fluids[no]['태그']
commlist = fluids[no]['댓글']
viewNum = fluids[no]['조회수']
이렇게 운용하면 될거야. 매우 합리적이네. ㅎㅎㅎㅇㅋ
즉,유사 datas로 관리되면되는것이야.ㅇㅋ.

지금 300개 글인데 datas가 154kb야. 어처구니없는거아니니???
3000개정도 들어간다치면, 1.5메가로 충분하겠지. 물론 본문이있으니뭐.ㅇㅋ.
아무튼 격리는 매우 훌륭한판단이란것.

headdatas에 주기적으로 태그정보랑 조회수등을 박아넣을까 싶기도 해 이러면.


태그리스트,
sort리스트
는 이제 따로 관리가 필요해. 추가로 내줘야겠고,js로 탐색알고리즘을 수행하는게 매우 낭비기에.

현재, 뮤즈태그는 이미 있다고 가정하고 자체 js소트를 진행 해.
유저태그는, 태그:[리스트] 를 가져온뒤에 역연산한것같고..
하지만 뮤즈태그 구축시에 이미 연산구조는 다 구축한 지 오래지.

ㅇㅇ특수요청들어왔고 논의결과, 분리하는게매우합당함.으헤헤헤.
심지어 댓글,추천,유저태그등 유동적으로 되는거에 영향 안 주고 수정이된다.ㅇㅋ.
일단은 백업이랄게없이 지우면 origins만 변경전에 두고 지우던가수정하던가 하고
글 열람을 안 하면 유동리스트에서 요청이안되지않나싶은데..
꼬이지않게하세요!

오후 4:49 2020-10-28
논의만 40분째로군;

1.datas에 직접 수정.이게젤편하지.
2.백업을 안 두고, 백업시 그냥 원본폴더꺼를 접근하면 됨.
3.수정로그를 두고, 이전/후 를 json으로 남기면 된다.우후후후후후...
ㅇㅇ본문은 롤백가능성이있으므로 이렇게처리하지뭐. 아니면이게 결국 git이잖아?!
귀찮으니 그냥 전/후로 모두 보존하기!
이미지도 이러면 극단적으로 가능한데..하 정말 이상하거든요??

어쩌다 서버 터져서, sd카드깨지는경우, 그건죽어야지뭐별수있나. 서버전체를 백업해야하지.
아무튼 그렇게 백업을 한다치면, static,datas,fluids를 백업하겠지요?? ㅇㅇ이거면됨.
이미지파일살려야하니 static도 같이 가야 마땅함.ㅇㅇ..
크롤러는크롤러일뿐야.그이상의 역할을 감당하게 하지 말자.

아니 sd카드가 깨졌는데 어쩌라고ㅋㅋㅋㅋ
아무튼 데이터베이스로 있어야하는건 datas 그자체야.그것 뿐.
이게없으면 원래txt가 뭐였나 모르니까 txt그냥 안지운거뿐이고.
origins는 그럼 그대로 두도록 할까싶고..
수정 자체를 한 경우, origins가 이전파일목록..역할을 대신하게 하는건 정말 끔찍해.
origins의 이미지는 단지 원본일뿐이니까.
굳이따지면 txt는 지워도되겠지..만 유니코드오류등 문제있으니 냅두는거고.
datas는 애초에 그 역할이 보존용이니, 건드리면 그대로 망가지는거라고 이해하자.
ㅇㅇ.txt는냅두자. 수정로그가 있으니 정안되면 그걸로추적가능함.ㅇㅋ.

1.datas수정하고 이미지만 getjar모방동작하게
2.datas수정,해당이미지만정확히교체..인데썸네일도다해야함; -지우면되지뭐.그게낫지않아?다지우는것보단..
2-2 datas수정하고, 해당이미지,썸네일,리사이즈를 정확히 지우고, 새로만들어서 각자 뿌리기.
중간오류시,,폐차장에서 다시 가져오고. 그게없어지면,    롤백은없다... 혹은그것도하던가.
근데 아예지워버리면, 이건 복원이 불가능해. 역시 저장하자.얼마되지도않겠고. 크롤링또할순없잖아.ㅇㅋ.
크롤링한건 정작 원본 안 둘 생각이다.ㅇㅇ. pastebin은 주기적으로 지워버리도록.
젤싫은건,20장중에 1장 교체했더니 20장에대한 걸 다 또수행하는거야. 그게 싫을 뿐..
근데나쁘지않은데요;
1.static에, 리사,원,썸 각 폴더가서 ,원본은 다시 jar로빼고, 나머진 삭제해버린다, 이후다시수행.
vs
2.해당파일시리즈만삭제.. txt는냅두고, dats수정,이력에남김. 삭제한이미지는, 원본만버려짐 통에 두기.

복원이라는과정이, 핀셋조정이아니라 그냥 시원하게 getjar를새로하게하는게 백번옳다.가능한그걸지향하기.ㅇㅋ..
근데 글자하나수정했다고 다하면 심히 빡칠거같아서말야.

오후 5:07 2020-10-28
%%%%%%%%%%%%%%%%
ㅇㅋ정신나간것같으니 그냥 datas,이력,이미지만수정 을 정책으로 확립합.txt는그냥버려두고.ㅇㅋ.
%%%%%%%%%%%%%%%%%%%%


이것은 일반로그랑 같이 기능하겠네.전상태를 둬 버리면 롤백이 진짜 되겠어! ..는아닌가; ㅇㅇ연산으로처리하자;
댓글추가시, 댓글내용이추가되었는데, 이 사실을 지우면 어케되는거지?? 뭐 그렇게되는거지.
조회수추가시, +1연산을 수행한것인데, 이 사실을 지우고 -1연산을 수행하면 매우합리적임.개추도동일.
11에서 12가되었다고해서 11로 롤백할순없지.ㅇㅋ논리적으로옳지않다.ㅇㅋ.
댓글추가시,댓글리스트에 3번댓글,댓글내용 이라고되어있으면 3번이 지워지고 공란으로 남는다. 나쁘지 않네.
태그추가시, 태그리스트에 그냥 하나가 추가되는거고, add된걸 remove하면 됨. 논리같고 개별적이다.
논의결과, 유저행동은 철저히 개별적으로, 상호작용 안 하게 하면 문제없다. 추가에 대한 역연산을 수행하도록..

로그는,서버측연산수행후 남겨지게하자.매우흐뭇하군.

datas static자료. 수정시 핀셋수정하게함. 제목,본문,파일등 생성당시에갖춰진정보만 딱 담고 있다. 날짜순정렬과.
fluids fluid자료. 움직이는것들 죄다 담고있게. 조회수,추천수,댓글목록,태그들까지.. 사용자행동의결과물들.후후.
logdatas 이력변경자료다. 본문수정,그림변경등 극히 일부의 datas직접접근기록. datas날아가도 이거랑크롤러로복구되게.
logfluids 사용자 변경이력. 제거복원가능하게. 태그댓글조회추천등, 직선적인 + - 의 일회 연산이 기록되어,추적가능.

뮤즈태그를 datas에배치하면 변태같지?? 근데 이거만 오버라이드해서 강제주입할까싶기도 해.
로그를 또남기면되는거니까. 어짜피 수정모드도 그렇고.흠.그러네. 새 글이 있단건, 뮤즈태그만큼은 박혀있단걸테니..
유저태그랑 분리하고싶어서그래.ㅇㅇ관리자접근시 들어가게하면되니까.ㅇㅋ승인. 둘다 datas에 접근하는건같으니까.

관리자모드시엔,
흠..이건 글 보기모드랑 구분하는게 좋지 싶어. html로 존재하지않는게 좋겠지.ㅇㅇ.애초에 받지도 못하게 만들자.
아무튼 getjar하기, 뮤즈태그입력, 
jar엔,투고를 해야 해.파이에서 돌리게할순없어.드라이버문제로.공감함. 투고식이적절하지.

글 투고 를 하게 하고, 어디폴더에 저장한 뒤에, 승인하면, getjar로 보내서 수행하게하자.
파일 열면 인젝션공격 당하진 않으려나; 바이너리 읽기라면 문제없겠지뭐..
규격맞추면 정규 datas에 편입되는것도 고려 가능하겠다..
이경우엔 하 어케하지

gif 리사이즈하려다 색깨져서집어치움.ㅇㅋ. 리사이즈에도 원본제공, 썸네일만 300300가기.ㅇㅋ.

결국 그대로잖아.하.
리사이즈는 아무튼 사실상 원본보기니까, gif는 원본그대로가기함. 썸네일느려져도 감수하라지뭐.
썸네일은 예쁘게 300300을 강제고정어떻게든하게했다.ㅇㅋ완료.

samenameList.append(iname)
를 둬서, 이미있으면, iname을 변경하도록 했다. uuid쓸까싶은데.. _1하는건 최악이고..
근데 이거 조건상
no_n.ext
의 규칙을 따를거야. 그러니, no_n이 여러개존재할시..
어쨌든이름이같으면이니까,, uuid붙이지뭐.이렇게까지해야하나..랜덤할까..?

random.randint(1,1000000)
로함.이게당연히빠르지;ㅇㅋ.





